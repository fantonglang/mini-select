!function(e){function t(e,t,n){const i=document.createElement("div");return i.className="ms-option",i.setAttribute("ms-id",e),i.innerHTML=t,n&&i.classList.add("ms-selected"),i}function n(e,t,n){const i=document.createElement("option");return i.value=e,i.text=t,n&&(i.selected=!0),i}function i(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}e.init_mini_select=function(e,s){if(s=s||{},e.dataset.miniSelectInited)return;e.id||(e.id=`mini-select-${i()}`),e.style.display="none",e.dataset.miniSelectInited=!0;var c=!!s.url;e.insertAdjacentHTML("afterend",function(e,t,n,i){return`\n      <div class="mini-select ${n?"ms-ac":""}" data-id="${e}">\n        <div class="ms-display">\n          ${t?`\n            <div class="ms-selected-text" ms-selected-id="${t.id}">\n              ${t.text}\n            </div>`:`<div class="ms-selected-text">${i||""}</div>`}\n          <div class="ms-arrow"></div>\n        </div>\n        ${n?'\n          <div class="ms-inp">\n            <input type="text" class="ms-input" placeholder="search..." autocomplete="off" />\n          </div>':""}\n        <div class="ms-options">\n          ${t?function(e,t){return`<div class="ms-option ${!0?"ms-selected":""}" ms-id="${e}">${t}</div>`}(t.id,t.text):""}\n        </div>\n      </div>`}(e.id,s.selected,c,e.getAttribute("placeholder")));const d=document.querySelector(`.mini-select[data-id="${e.id}"]`),l=d.querySelector(".ms-inp input"),o=d.querySelector(".ms-options");let r=1,a=!0,u=!1;if(d.querySelector(".ms-selected-text[ms-selected-id]")){const t=d.querySelector(".ms-selected-text").getAttribute("ms-selected-id"),i=d.querySelector(".ms-selected-text").innerHTML;e.appendChild(n(t,i,!0))}async function m(c=!1){c||(o.innerHTML="",r=1,a=!0,e.innerHtml="",e.appendChild(n("","",!1)));const u=d.querySelector(".ms-selected-text").getAttribute("ms-selected-id"),m=await fetch(`${s.url}?q=${l.value}&page=${r}&uuid=${i()}`),x=await m.json();a=!(!x.pagination||!x.pagination.more),x.results.forEach(function(i){o.appendChild(t(i.id,i.text,i.id==u)),e.appendChild(n(i.id,i.text,i.id==u))})}d.querySelector(".ms-display").addEventListener("click",async function(){l&&(d.classList.contains("ms-open")?l.blur():(setTimeout(function(){l.focus()},300),0===o.children.length&&m())),d.classList.toggle("ms-open")}),l&&(l.addEventListener("input",function(e,t){let n;return function(...i){const s=this;clearTimeout(n),n=setTimeout(()=>e.apply(s,i),t)}}(function(){m()},250)),o.addEventListener("scroll",async function(){if(o.scrollHeight-o.scrollTop<=o.clientHeight+10&&a){if(u)return;u=!0,r++,await m(!0),u=!1}})),s.data&&(o.innerHTML="",e.appendChild(n("","",!1)),s.data.forEach(function(i){o.appendChild(t(i.id,i.text,i.selected)),e.appendChild(n(i.id,i.text,i.selected))})),function(e,t,n,i){e.addEventListener(n,function(n){for(var s=n.target;s&&s!==e;){if(s.matches(t)){i.call(s,n);break}s=s.parentNode}})}(o,".ms-option","click",function(){const t=this.getAttribute("ms-id");d.querySelector(".ms-selected-text").setAttribute("ms-selected-id",t),d.querySelector(".ms-selected-text").innerHTML=this.innerHTML,d.querySelectorAll(".ms-option").forEach(function(e){e.classList.remove("ms-selected")}),this.classList.add("ms-selected"),e.value=t;const n=new Event("change",{bubbles:!0});e.dispatchEvent(n),d.classList.remove("ms-open")})},document.addEventListener("DOMContentLoaded",function(){document.body.addEventListener("click",function(e){var t=document.querySelectorAll(".mini-select"),n=e.target.closest(".mini-select");t.forEach(e=>{e!==n&&e.classList.remove("ms-open")})})})}(window);