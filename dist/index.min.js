!function(e){var t=0;function n(e,t,n){const s=document.createElement("div");return s.className="ms-option",s.setAttribute("ms-id",e),s.innerHTML=t,n&&s.classList.add("ms-selected"),i([s]),s}function s(e,t,n){const s=document.createElement("option");return s.value=e,s.text=t,n&&(s.selected=!0),s}function i(e){e.forEach(function(e){e.addEventListener("mouseover",function(){this.parentNode.querySelectorAll(".ms-option").forEach(function(e){e.classList.remove("ms-hover")}),this.classList.add("ms-hover")})})}function o(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}e.initMiniSelect=function(e,c){if(c=c||{},e.dataset.miniSelectInited)return;e.id||(e.id=`mini-select-${o()}`),e.style.display="none",e.dataset.miniSelectInited=!0;var r=!!c.url;e.insertAdjacentHTML("afterend",function(e,t,n,s){return`\n    <div class="mini-select ${n?"ms-ac":""}" data-id="${e}">\n      <input type="text" class="dummy">\n      <div class="ms-display">\n        ${t?`\n          <div class="ms-selected-text" ms-selected-id="${t.id}">\n            ${t.text}\n          </div>`:`<div class="ms-selected-text">${s||""}</div>`}\n        <div class="ms-arrow"></div>\n      </div>\n      ${n?'\n        <div class="ms-inp">\n          <input type="text" class="ms-input" placeholder="search..." autocomplete="off" />\n        </div>':""}\n      <div class="ms-options">\n        ${t?function(e,t){return`<div class="ms-option ${!0?"ms-selected":""} ${!0?"ms-hover":""}" ms-id="${e}">${t}</div>`}(t.id,t.text):""}\n      </div>\n    </div>`}(e.id,c.selected,r,e.getAttribute("placeholder")));const l=document.querySelector(`.mini-select[data-id="${e.id}"]`),d=l.querySelectorAll(".ms-option");d.length>0&&i(d);const a=l.querySelector(".ms-inp input"),u=l.querySelector(".ms-options");let m=1,f=!0,p=!1;if(l.querySelector(".ms-selected-text[ms-selected-id]")){const t=l.querySelector(".ms-selected-text").getAttribute("ms-selected-id"),n=l.querySelector(".ms-selected-text").innerHTML;e.appendChild(s(t,n,!0))}async function v(i=!1){var r=++t;i||(u.innerHTML="",m=1,f=!0,e.innerHtml="",e.appendChild(s("","",!1)));const d=l.querySelector(".ms-selected-text").getAttribute("ms-selected-id"),p=await fetch(`${c.url}?q=${a.value}&page=${m}&uuid=${o()}`),v=await p.json();r===t&&(f=!(!v.pagination||!v.pagination.more),v.results.forEach(function(t){u.appendChild(n(t.id,t.text,t.id==d)),e.appendChild(s(t.id,t.text,t.id==d))}))}l.querySelector(".ms-display").addEventListener("click",async function(){a&&(l.classList.contains("ms-open")?a.blur():(setTimeout(function(){a.focus()},300),0===u.children.length&&v())),l.classList.toggle("ms-open"),l.classList.remove("ms-focus")}),a&&(a.addEventListener("input",function(e,t){let n;return function(...s){const i=this;clearTimeout(n),n=setTimeout(()=>e.apply(i,s),t)}}(function(){v()},250)),u.addEventListener("scroll",async function(){if(u.scrollHeight-u.scrollTop<=u.clientHeight+10&&f){if(p)return;p=!0,m++,await v(!0),p=!1}})),c.data&&(u.innerHTML="",e.appendChild(s("","",!1)),c.data.forEach(function(t){u.appendChild(n(t.id,t.text,t.selected)),e.appendChild(s(t.id,t.text,t.selected))})),function(e,t,n,s){e.addEventListener(n,function(n){for(var i=n.target;i&&i!==e;){if(i.matches(t)){s.call(i,n);break}i=i.parentNode}})}(u,".ms-option","click",function(){const t=this.getAttribute("ms-id");l.querySelector(".ms-selected-text").setAttribute("ms-selected-id",t),l.querySelector(".ms-selected-text").innerHTML=this.innerHTML,l.querySelectorAll(".ms-option").forEach(function(e){e.classList.remove("ms-selected")}),this.classList.add("ms-selected"),e.value=t;const n=new Event("change",{bubbles:!0});e.dispatchEvent(n),l.classList.remove("ms-open")}),l.querySelector(".dummy").addEventListener("focus",function(){l.classList.add("ms-focus")}),l.querySelector(".dummy").addEventListener("blur",function(){l.classList.remove("ms-focus")}),l.querySelector(".dummy").addEventListener("keydown",function(e){"Enter"===e.key&&(e.preventDefault(),this.blur(),setTimeout(function(){l.querySelector(".ms-display").click()},0))}),document.addEventListener("keydown",function(e){if(("ArrowDown"===e.key||"ArrowUp"===e.key||"Enter"===e.key)&&l.classList.contains("ms-open")){if(e.preventDefault(),"ArrowDown"===e.key){let e=u.querySelector(".ms-option.ms-hover"),t=null;if(e){if(!e.nextElementSibling)return;t=e.nextElementSibling}else{const e=u.querySelector(".ms-option");e&&(t=e)}e&&e.classList.remove("ms-hover"),t.classList.add("ms-hover"),t.offsetTop+t.offsetHeight>=u.scrollTop+u.clientHeight&&(u.scrollTop=t.offsetTop-(u.clientHeight-t.offsetHeight))}if("ArrowUp"===e.key){const e=u.querySelector(".ms-option.ms-hover");if(!e||!e.previousElementSibling)return;const t=e.previousElementSibling;e.classList.remove("ms-hover"),t.classList.add("ms-hover"),t.offsetTop<u.scrollTop&&(u.scrollTop=t.offsetTop)}if("Enter"===e.key){const e=u.querySelector(".ms-option.ms-hover");e&&e.click()}}})},document.addEventListener("DOMContentLoaded",function(){document.body.addEventListener("click",function(e){var t=document.querySelectorAll(".mini-select"),n=e.target.closest(".mini-select");t.forEach(e=>{e!==n&&e.classList.remove("ms-open")})})})}(window);